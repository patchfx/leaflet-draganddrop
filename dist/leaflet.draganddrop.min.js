L.Util.extend(L.DomUtil,{supportsBoxModel:"CSS1Compat"===document.compatMode,dimensions:function(a){return{width:a.offsetWidth,height:a.offsetHeight}},offset:function(a){var a=a.getBoundingClientRect(),b=document.body,c=document.documentElement;return new L.Point(a.left+(window.pageXOffset||this.supportsBoxModel&&c.scrollLeft||b.scrollLeft)-(c.clientLeft||b.clientLeft||0),a.top+(window.pageYOffset||this.supportsBoxModel&&c.scrollTop||b.scrollTop)-(c.clientTop||b.clientTop||0))}});
L.Droppable=L.Class.extend({initialize:function(a){this._element=a;this.measureElement()},measureElement:function(){this._dimensions=L.DomUtil.dimensions(this._element);this._offset=L.DomUtil.offset(this._element)},getElement:function(){return this._element},isOver:function(a){var b=this._offset.x,c=b+this._dimensions.width,d=this._offset.y,e=d+this._dimensions.height;return a.x>b&&a.x<c&&a.y>d&&a.y<e}});
L.DropManager=L.Class.extend({options:{zIndex:999},_droppables:[],initialize:function(a,b){L.Util.setOptions(this,b);for(var c=0,d=a.length;c<d;c++)this._droppables.push(new L.Droppable(a[c]));this._createDummyIcon();L.DomEvent.on(window,"resize",this._onResize,this)},getDummyIcon:function(){return this._dummyIcon},updateDummyIcon:function(a){var b=L.DomUtil.offset(a._icon),c=a.options.icon._getIconUrl("icon");this._sourceMarker=a;L.DomUtil.setPosition(this._dummyIcon,b);L.Browser.ie6?this._dummyIcon.style.filter=
'progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+c+'")':this._dummyIcon.src=c;this._dummyIcon.className=this._sourceMarker._icon.className;this._dummyIcon.style.width=this._sourceMarker._icon.style.width;this._dummyIcon.style.height=this._sourceMarker._icon.style.height;L.Browser.any3d&&(this._dummyIcon.style.marginTop="-15px")},startDrag:function(){this._dummyIcon.style.display="block";this._dummyIconDimensions=L.DomUtil.dimensions(this._dummyIcon)},stopDrag:function(){this._dummyIcon.style.display=
"none";this._overDroppable&&this._sourceMarker.fire("dropped",{container:this._overDroppable.getElement(),data:this._sourceMarker.options.data}).fire("leftdropcontainer",{container:this._overDroppable.getElement()});this._sourceMarker=this._overDroppable=null},checkOverDroppable:function(a){L.DomUtil.offset(this._dummyIcon);var b;if(this._overDroppable){if(this._overDroppable.isOver(a))return;this._sourceMarker.fire("leftdropcontainer",{container:this._overDroppable.getElement()});this._overDroppable=
null}for(var c=0,d=this._droppables.length;c<d;c++)if(b=this._droppables[c],b.isOver(a)){this._sourceMarker.fire("overdropcontainer",{container:b.getElement()});this._overDroppable=b;break}},_createDummyIcon:function(){this._dummyIcon=L.Browser.ie6?document.createElement("div"):document.createElement("img");this._dummyIcon.setAttribute("id","leaflet-dummy-icon");this._dummyIcon.style.zIndex=this.options.zIndex;this._dummyIcon.style.display="none";document.body.insertBefore(this._dummyIcon,document.body.firstChild)},
_onResize:function(){console.log("_onResize");this._resizeTimeout&&clearTimeout(this._resizeTimeout);this._resizeTimeout=setTimeout(L.Util.bind(this._remeasureDroppables,this),200)},_remeasureDroppables:function(){for(var a=0,b=this._droppables.length;a<b;a++)this._droppables[a].measureElement()}});
L.DragAndDropMarker=L.Marker.extend({defaults:{draganddrop:!0},initialize:function(a,b){b=L.Util.extend({},this.defaults,b);b.draggable=!b.draganddrop?b.draggable:!1;L.Marker.prototype.initialize.call(this,a,b)},_initInteraction:function(){L.Marker.prototype._initInteraction.call(this);L.Handler.DragAndDropMarkerDrag&&(this.dragging=new L.Handler.DragAndDropMarkerDrag(this,this.options),this.options.draganddrop&&this.dragging.enable())}});
L.Handler.DragAndDropMarkerDrag=L.Handler.MarkerDrag.extend({options:{},initialize:function(a,b){if(!b.dropManager)throw"options.dropManager must be set.";L.Util.setOptions(this,b);L.Handler.MarkerDrag.prototype.initialize.call(this,a)},addHooks:function(){var a=this._marker._icon;this._draggable||(this._draggable=(new L.Draggable(this.options.dropManager.getDummyIcon(),a)).on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),this._marker.on("mouseover",
this._onOverMarker,this));this._draggable.enable()},_onDragStart:function(){this._marker._icon.style.display="none";this._marker._shadow&&(this._marker._shadow.style.display="none");this.options.dropManager.startDrag();this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(a){var b=a.target._newPos,a=a.target._startPoint.subtract(a.target._startPos),b=b.add(a);this.options.dropManager.checkOverDroppable(b);this._marker.fire("move").fire("drag")},_onDragEnd:function(){this.options.dropManager.stopDrag();
this._marker._icon.style.display="block";this._marker._shadow&&(this._marker._shadow.style.display="block");this._marker.fire("moveend").fire("dragend")},_onOverMarker:function(){(!this._draggable||!this._draggable._moving)&&this.options.dropManager.updateDummyIcon(this._marker)},_checkOverDropContainer:function(a){var b=new L.Point(document.body.scrollLeft,document.body.scrollTop),a=a.subtract(b);this._dummyMarker.style.display="none";this._dropContainer===document.elementFromPoint(a.x,a.y)?(this._enteredDropContainer=
!0,this._marker.fire("overdropcontainer")):this._enteredDropContainer&&(this._enteredDropContainer=!1,this._marker.fire("leftdropcontainer"));this._dummyMarker.style.display="block"}});